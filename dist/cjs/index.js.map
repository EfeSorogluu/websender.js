{"version":3,"sources":["../../src/index.ts","../../src/libs/websender.ts"],"sourcesContent":["import { Websender } from './libs/websender.js';\r\nimport type { WebsenderConfig, WebsenderResponse } from './types/websender';\r\n\r\nexport {\r\n    Websender,\r\n    type WebsenderConfig,\r\n    type WebsenderResponse\r\n};\r\n\r\nexport default Websender;\r\n\r\nconsole.log('Use \"npm run test\" to test the library.');","import * as net from 'net';\r\nimport * as crypto from 'crypto';\r\nimport type { WebsenderConfig, WebsenderResponse } from '../types/websender';\r\n\r\ninterface SocketError extends Error {\r\n    code?: string;\r\n}\r\n\r\nexport class Websender {\r\n    private host: string;\r\n    private password: string;\r\n    private port: number;\r\n    private timeout: number;\r\n    private socket: net.Socket | null = null;\r\n\r\n    constructor(config: WebsenderConfig) {\r\n        this.host = config.host;\r\n        this.password = config.password;\r\n        this.port = config.port;\r\n        this.timeout = config.timeout || 30;\r\n    }\r\n\r\n    public async connect(): Promise<WebsenderResponse> {\r\n        return new Promise((resolve) => {\r\n            try {\r\n                this.socket = net.createConnection({\r\n                    host: this.host,\r\n                    port: this.port,\r\n                    timeout: this.timeout * 1000\r\n                });\r\n\r\n                this.socket.on('connect', async () => {\r\n                    try {\r\n                        // Send connection request\r\n                        this.writeRawByte(1);\r\n                        \r\n                        // Wait for challenge\r\n                        const challenge = await this.readRawInt();\r\n                        // Calculate and send hash\r\n                        const hash = crypto.createHash('sha512')\r\n                            .update(challenge.toString() + this.password)\r\n                            .digest('hex');\r\n                        this.writeString(hash);\r\n                        \r\n                        // Wait for response\r\n                        const response = await this.readRawInt();\r\n                        \r\n                        resolve({\r\n                            success: response === 1\r\n                        });\r\n                    } catch (error) {\r\n                        console.error('[WebSenderJS] Authentication error:', error);\r\n                        resolve({\r\n                            success: false,\r\n                            error: error instanceof Error ? error.message : 'Unknown error during authentication'\r\n                        });\r\n                    }\r\n                });\r\n\r\n                this.socket.on('error', (error: SocketError) => {\r\n                    console.error('[WebSenderJS] Socket error:', error);\r\n                    let errorMessage = 'Connection error';\r\n                    \r\n                    if (error.code === 'ECONNREFUSED') {\r\n                        errorMessage = `Connection refused. Please check if:\r\n                        1. The Minecraft server is running\r\n                        2. The Websender plugin is installed\r\n                        3. The port ${this.port} is correct\r\n                        4. The server is not blocking connections`;\r\n                    } else if (error.code === 'ETIMEDOUT') {\r\n                        errorMessage = 'Connection timed out. The server might be down or unreachable';\r\n                    } else if (error.code === 'ENOTFOUND') {\r\n                        errorMessage = `Could not resolve host ${this.host}. Please check if the hostname is correct`;\r\n                    }\r\n                    \r\n                    resolve({\r\n                        success: false,\r\n                        error: errorMessage\r\n                    });\r\n                });\r\n\r\n                this.socket.on('timeout', () => {\r\n                    console.error('[WebSenderJS] Connection timeout');\r\n                    resolve({\r\n                        success: false,\r\n                        error: 'Connection timeout. The server might be down or unreachable'\r\n                    });\r\n                });\r\n            } catch (error) {\r\n                console.error('[WebSenderJS] Connection setup error:', error);\r\n                resolve({\r\n                    success: false,\r\n                    error: error instanceof Error ? error.message : 'Unknown error during connection setup'\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public async sendCommand(command: string): Promise<WebsenderResponse> {\r\n        if (!this.socket) {\r\n            return { success: false, error: 'Not connected' };\r\n        }\r\n\r\n        try {\r\n            this.writeRawByte(2);\r\n            this.writeString(Buffer.from(command).toString('base64'));\r\n            const response = await this.readRawInt();\r\n            return { success: response === 1 };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error instanceof Error ? error.message : 'Unknown error'\r\n            };\r\n        }\r\n    }\r\n\r\n    public async sendMessage(message: string): Promise<WebsenderResponse> {\r\n        if (!this.socket) {\r\n            return { success: false, error: 'Not connected' };\r\n        }\r\n\r\n        try {\r\n            this.writeRawByte(4);\r\n            this.writeString(Buffer.from(message).toString('base64'));\r\n            const response = await this.readRawInt();\r\n            return { success: response === 1 };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error instanceof Error ? error.message : 'Unknown error'\r\n            };\r\n        }\r\n    }\r\n\r\n    public async disconnect(): Promise<WebsenderResponse> {\r\n        if (!this.socket) {\r\n            return { success: false, error: 'Not connected' };\r\n        }\r\n\r\n        try {\r\n            this.writeRawByte(3);\r\n            this.socket.destroy();\r\n            this.socket = null;\r\n            return { success: true };\r\n        } catch (error) {\r\n            return {\r\n                success: false,\r\n                error: error instanceof Error ? error.message : 'Unknown error'\r\n            };\r\n        }\r\n    }\r\n\r\n    private writeRawInt(value: number): void {\r\n        if (!this.socket) return;\r\n        const buffer = Buffer.alloc(4);\r\n        buffer.writeInt32BE(value, 0);\r\n        this.socket.write(buffer);\r\n    }\r\n\r\n    private writeRawByte(byte: number): void {\r\n        if (!this.socket) return;\r\n        const buffer = Buffer.alloc(1);\r\n        buffer.writeUInt8(byte, 0);\r\n        this.socket.write(buffer);\r\n    }\r\n\r\n    private writeString(str: string): void {\r\n        if (!this.socket) return;\r\n        const chars = str.split('');\r\n        this.writeRawInt(chars.length);\r\n        for (const char of chars) {\r\n            const code = char.charCodeAt(0);\r\n            this.writeRawByte((0xff & (code >> 8)));\r\n            this.writeRawByte((0xff & code));\r\n        }\r\n    }\r\n\r\n    private readRawInt(): Promise<number> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.socket) {\r\n                reject(new Error('Not connected'));\r\n                return;\r\n            }\r\n\r\n            const readData = () => {\r\n                const buffer = this.socket!.read(4);\r\n                if (buffer) {\r\n                    resolve(buffer.readInt32BE(0));\r\n                } else {\r\n                    this.socket!.once('readable', readData);\r\n                }\r\n            };\r\n\r\n            readData();\r\n        });\r\n    }\r\n\r\n    private readRawByte(): Promise<number> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.socket) {\r\n                reject(new Error('Not connected'));\r\n                return;\r\n            }\r\n\r\n            const readData = () => {\r\n                const buffer = this.socket!.read(1);\r\n                if (buffer) {\r\n                    resolve(buffer.readUInt8(0));\r\n                } else {\r\n                    this.socket!.once('readable', readData);\r\n                }\r\n            };\r\n\r\n            readData();\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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","names":[]}